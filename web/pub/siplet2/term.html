<HTML>
<HEAD>
 <style>
    body { 
        margin: 0; padding: 0;
    }
</style>
<SCRIPT LANGUAGE=JavaScript>
    /*
            // Create sandboxed iframe
            var iframe = document.createElement("iframe");
            iframe.setAttribute("sandbox", "allow-scripts");
            iframe.style.display = "none";
            document.body.appendChild(iframe);

            // Plugin script (user-submitted, e.g., adds a message)
            var pluginCode = `
                function safeExecute(input) {
                    // Safe API: Only allow appending to content
                    return "<p>Plugin processed: " + input + "</p>";
                }
                var result = safeExecute("${input}");
                window.parent.postMessage(result, "*");
            `;

            // Write plugin code to iframe
            var script = iframe.contentWindow.document.createElement("script");
            script.textContent = pluginCode;
            iframe.contentWindow.document.body.appendChild(script);
            // Listen for plugin output
            window.addEventListener("message", function(event) {
                var content = document.getElementById("W0");
                content.innerHTML += event.data;
                content.scrollTop = content.scrollHeight - content.clientHeight;
                document.body.removeChild(iframe); // Clean up
            }, { once: true });
            
            const pluginWorker = new Worker('pluginWorker.js');
            pluginWorker.onmessage = function(e) {
                var content = document.getElementById("W0");
                content.innerHTML += "<p>" + e.data + "</p>";
                content.scrollTop = content.scrollHeight - content.clientHeight;
            };

            function inputKeyPress(element, event) {
                if (event.keyCode === 13) {
                    event.preventDefault();
                    var content = document.getElementById("W0");
                    content.innerHTML += "<p>" + element.value + "</p>";
                    content.scrollTop = content.scrollHeight - content.clientHeight;
                    // Send input to plugin
                    pluginWorker.postMessage(element.value);
                    element.value = "";
                }
            }
            
            javascript

            self.onmessage = function(e) {
                // Plugin receives input (e.g., "Hello")
                var input = e.data;
                // Process input (example plugin logic)
                var output = "Plugin processed: " + input.toUpperCase();
                // Send message back to main thread
                self.postMessage(output);
            };

       */

</SCRIPT>
</HEAD>
<BODY>
<FONT COLOR=WHITE>
<SCRIPT LANGUAGE=JavaScript src="js/config.js"></SCRIPT>
<SCRIPT LANGUAGE=JavaScript src="js/input.js"></SCRIPT>
<SCRIPT LANGUAGE=JavaScript src="js/menu.js"></SCRIPT>
<SCRIPT LANGUAGE=JavaScript src="js/tabs.js"></SCRIPT>
<SCRIPT LANGUAGE=JavaScript src="js/util.js"></SCRIPT>
<SCRIPT LANGUAGE=JavaScript src="js/ctxmenu.js"></SCRIPT>
<SCRIPT LANGUAGE=JavaScript src="js/siplet.js"></SCRIPT>
<SCRIPT LANGUAGE=JavaScript src="js/binparser.js"></SCRIPT>
<SCRIPT LANGUAGE=JavaScript src="js/ansiparser.js"></SCRIPT>
<SCRIPT LANGUAGE=JavaScript src="js/telnetparser.js"></SCRIPT>
<SCRIPT LANGUAGE=JavaScript src="js/textparser.js"></SCRIPT>
<SCRIPT LANGUAGE=JavaScript src="js/mspsupport.js"></SCRIPT>
<SCRIPT LANGUAGE=JavaScript src="js/mxpsupport.js"></SCRIPT>
<div id="menuarea"></div>
<div id="tabarea"></div>
<div id="windowarea"></div>
<div id="inputarea">
    <textarea rows=3 type="text" id="input"></textarea>
</div>
<SCRIPT LANGUAGE=JavaScript>
configureInput(document.getElementById('inputarea'), document.getElementById('input'));
configureMenu(document.getElementById('menuarea'));
configureTabs(document.getElementById('tabarea'));
var tabStyle = window.getComputedStyle(document.getElementById('tabarea'));
var winAreaTop = parseInt(tabStyle.top) + parseInt(tabStyle.height) + 1;
var winAreaHeight = 'calc(100% - '+(winAreaTop+inputAreaHeight)+'px)';
window.windowArea = document.getElementById('windowarea');
window.windowArea.style.cssText='background-color:black;position:absolute;width:100%;top:'+winAreaTop+'px;height:'+winAreaHeight+';';
var autoUrl = getConfig('/phonebook/auto',{"ws":"ws://coffeemud.net:27744/WebSock"}).ws;
if(autoUrl.length > 0)
	AddNewSipletTab(autoUrl);
window.addEventListener("beforeunload", CloseAllSiplets);
</SCRIPT>
</FONT>
</BODY>
<HTML>