<HTML>
<HEAD>
 <style>
    body { 
        margin: 0; padding: 0;
    }
    .gauge {
        position: fixed;
        top: 0;
        width: 100%;
        height: 20px;
        background: black;
    }
    .input-area {
        position: fixed;
        bottom: 0;
        width: 100%;
        height: 70px;
        background: #f0f0f0;
    }
    .input-area textarea {
        width: 90%;
        margin: 5px;
        padding: 5px;
    }
</style>
<SCRIPT LANGUAGE=JavaScript>
    function inputKeyPress(i,e)
    {
        if(e.keyCode == 13)
        {
            e.preventDefault();
            currentSiplet.submitInput(i.value);
            i.value='';
        }
    }
    
    function addToPrompt(x,att)
    {
        var entry = document.getElementById('input');
        entry.value='';
        if(att)
            currentSiplet.submitInput(x);
        else
            entry.value=x+" ";
    }
    function boxFocus() 
    {
        setTimeout(function() {
            var entry = document.getElementById('input');
            entry.focus();
        }, 100);
    }
    /*
            // Create sandboxed iframe
            var iframe = document.createElement("iframe");
            iframe.setAttribute("sandbox", "allow-scripts");
            iframe.style.display = "none";
            document.body.appendChild(iframe);

            // Plugin script (user-submitted, e.g., adds a message)
            var pluginCode = `
                function safeExecute(input) {
                    // Safe API: Only allow appending to content
                    return "<p>Plugin processed: " + input + "</p>";
                }
                var result = safeExecute("${input}");
                window.parent.postMessage(result, "*");
            `;

            // Write plugin code to iframe
            var script = iframe.contentWindow.document.createElement("script");
            script.textContent = pluginCode;
            iframe.contentWindow.document.body.appendChild(script);
            // Listen for plugin output
            window.addEventListener("message", function(event) {
                var content = document.getElementById("W0");
                content.innerHTML += event.data;
                content.scrollTop = content.scrollHeight - content.clientHeight;
                document.body.removeChild(iframe); // Clean up
            }, { once: true });
            
            const pluginWorker = new Worker('pluginWorker.js');
            pluginWorker.onmessage = function(e) {
                var content = document.getElementById("W0");
                content.innerHTML += "<p>" + e.data + "</p>";
                content.scrollTop = content.scrollHeight - content.clientHeight;
            };

            function inputKeyPress(element, event) {
                if (event.keyCode === 13) {
                    event.preventDefault();
                    var content = document.getElementById("W0");
                    content.innerHTML += "<p>" + element.value + "</p>";
                    content.scrollTop = content.scrollHeight - content.clientHeight;
                    // Send input to plugin
                    pluginWorker.postMessage(element.value);
                    element.value = "";
                }
            }
            
            javascript

            self.onmessage = function(e) {
                // Plugin receives input (e.g., "Hello")
                var input = e.data;
                // Process input (example plugin logic)
                var output = "Plugin processed: " + input.toUpperCase();
                // Send message back to main thread
                self.postMessage(output);
            };

       */

</SCRIPT>
</HEAD>
<BODY>
<FONT COLOR=WHITE>
<SCRIPT LANGUAGE=JavaScript src="js/util.js"></SCRIPT>
<SCRIPT LANGUAGE=JavaScript src="js/ctxmenu.js"></SCRIPT>
<SCRIPT LANGUAGE=JavaScript src="js/siplet.js"></SCRIPT>
<SCRIPT LANGUAGE=JavaScript src="js/binparser.js"></SCRIPT>
<SCRIPT LANGUAGE=JavaScript src="js/ansiparser.js"></SCRIPT>
<SCRIPT LANGUAGE=JavaScript src="js/telnetparser.js"></SCRIPT>
<SCRIPT LANGUAGE=JavaScript src="js/textparser.js"></SCRIPT>
<SCRIPT LANGUAGE=JavaScript src="js/mspsupport.js"></SCRIPT>
<SCRIPT LANGUAGE=JavaScript src="js/mxpsupport.js"></SCRIPT>
<div id="W0">
</div>
<div class="input-area">
    <textarea rows=3 type="text" id="input" onkeypress="inputKeyPress(this,event);"></textarea>
</div>
<SCRIPT LANGUAGE=JavaScript>
var inputAreaHeight = 70; //document.getElementById("input").style.height;
var siplet = new SipletWindow('W0'); // makes a deep copy
var currentSiplet = siplet;
siplet.connect("ws://localhost:27744/WebSock");
</SCRIPT>
</FONT>
</BODY>
<HTML>